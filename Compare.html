<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compare Chart</title>
    <script src="https://unpkg.com/chart.js@2.8.0/dist/Chart.bundle.js"></script>
    <script src="https://unpkg.com/chartjs-gauge@0.3.0/dist/chartjs-gauge.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        #canvas-holder {
            width: 100%;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="index.html"
               style="color: green; font-size: 36px; font-weight: bold; text-decoration: none;">Vethukko</a>
            <!-- END: ed8c6549bwf9 -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html"> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="active nav-link" href="Compare.html">Compare</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Map.html">Map</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">About US</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="row mt-3">
        <div class="col-md-4">
            <form id="searchForm">
                <div class="row justify-content-center">
                    <div class="row justify-content-center">
                        <div class="col-md-auto">
                            <select id="apartmentSelect" class="form-select form-field">
                                <option value="">Select Apartment</option>
                            </select>
                            </div>
                        </div>
                        <div class="row justify-content-center mt-3">
                            <div class="col-md-auto">
                                <select id="bedSelect" class="form-select form-field">
                                    <option value="">Select Bed</option>
                                </select>
                            </div>
                        </div>
                    </div>
                <div class="row justify-content-center mt-3">
                    <div class="col-md-auto">
                        <button type="submit" class="btn btn-primary">Search</button>
                    </div>
                </div>
            </form>
        </div>
        <div class="col-md-7">
            <div id="canvas-holder">
                <canvas id="chart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Embedded JSON data
        var data = [
  {
    "Id": 1,
    "apartmentName": "Viridian Apartments",
    "bed": 1,
    "bath": 1,
    "sqFt": 546,
    "minPrice": 1319,
    "maxPrice": 1663,
    "bullRunner": "Yes"
  },
  {
    "Id": 2,
    "apartmentName": "Viridian Apartments",
    "bed": 1,
    "bath": 1,
    "sqFt": 816,
    "minPrice": 1366,
    "maxPrice": 1894,
    "bullRunner": "Yes"
  },
  {
    "Id": 3,
    "apartmentName": "Viridian Apartments",
    "bed": 1,
    "bath": 1,
    "sqFt": 725,
    "minPrice": 1426,
    "maxPrice": 1807,
    "bullRunner": "Yes"
  },
  {
    "Id": 4,
    "apartmentName": "Viridian Apartments",
    "bed": 2,
    "bath": 2,
    "sqFt": 943,
    "minPrice": 1505,
    "maxPrice": 1741,
    "bullRunner": "Yes"
  },
  {
    "Id": 5,
    "apartmentName": "Viridian Apartments",
    "bed": 2,
    "bath": 2,
    "sqFt": 1059,
    "minPrice": 1555,
    "maxPrice": 1841,
    "bullRunner": "Yes"
  },
  {
    "Id": 6,
    "apartmentName": "Viridian Apartments",
    "bed": 3,
    "bath": 2,
    "sqFt": 1293,
    "minPrice": 2297,
    "maxPrice": 3040,
    "bullRunner": "Yes"
  },
  {
    "Id": 7,
    "apartmentName": "Cambridge Woods",
    "bed": 1,
    "bath": 1,
    "sqFt": 580,
    "minPrice": 1289,
    "maxPrice": 1450,
    "bullRunner": "Yes"
  },
  {
    "Id": 8,
    "apartmentName": "Cambridge Woods",
    "bed": 1,
    "bath": 1,
    "sqFt": 750,
    "minPrice": 1432,
    "maxPrice": 1497,
    "bullRunner": "Yes"
  },
  {
    "Id": 9,
    "apartmentName": "Cambridge Woods",
    "bed": 1,
    "bath": 1,
    "sqFt": 650,
    "minPrice": 1880,
    "maxPrice": 1880,
    "bullRunner": "Yes"
  },
  {
    "Id": 10,
    "apartmentName": "Cambridge Woods",
    "bed": 2,
    "bath": 2.5,
    "sqFt": 1200,
    "minPrice": 1695,
    "maxPrice": 2055,
    "bullRunner": "Yes"
  },
  {
    "Id": 11,
    "apartmentName": "Cambridge Woods",
    "bed": 2,
    "bath": 2.5,
    "sqFt": 1163,
    "minPrice": 2098,
    "maxPrice": 2098,
    "bullRunner": "Yes"
  },
  {
    "Id": 12,
    "apartmentName": "Cambridge Woods",
    "bed": 2,
    "bath": 2.5,
    "sqFt": 1024,
    "minPrice": 1640,
    "maxPrice": 1780,
    "bullRunner": "Yes"
  },
  {
    "Id": 13,
    "apartmentName": "Cambridge Woods",
    "bed": 2,
    "bath": 1.5,
    "sqFt": 1309,
    "minPrice": 1675,
    "maxPrice": 1917,
    "bullRunner": "Yes"
  },
  {
    "Id": 14,
    "apartmentName": "Cambridge Woods",
    "bed": 3,
    "bath": 2.5,
    "sqFt": 1454,
    "minPrice": 2246,
    "maxPrice": 2655,
    "bullRunner": "Yes"
  },
  {
    "Id": 15,
    "apartmentName": "Cambridge Woods",
    "bed": 3,
    "bath": 2,
    "sqFt": 1525,
    "minPrice": 2197,
    "maxPrice": 2741,
    "bullRunner": "Yes"
  },
  {
    "Id": 16,
    "apartmentName": "LakeView Oaks",
    "bed": 1,
    "bath": 1,
    "sqFt": 844,
    "minPrice": 1789,
    "maxPrice": 2049,
    "bullRunner": "No"
  },
  {
    "Id": 17,
    "apartmentName": "LakeView Oaks",
    "bed": 2,
    "bath": 2,
    "sqFt": 1076,
    "minPrice": 1899,
    "maxPrice": 2169,
    "bullRunner": "No"
  },
  {
    "Id": 18,
    "apartmentName": "LakeView Oaks",
    "bed": 3,
    "bath": 3,
    "sqFt": 1354,
    "minPrice": 2399,
    "maxPrice": 2629,
    "bullRunner": "No"
  },
  {
    "Id": 19,
    "apartmentName": "Oak Ramble",
    "bed": 1,
    "bath": 1,
    "sqFt": 735,
    "minPrice": 1467,
    "maxPrice": 1557,
    "bullRunner": "Yes"
  },
  {
    "Id": 20,
    "apartmentName": "Oak Ramble",
    "bed": 1,
    "bath": 1,
    "sqFt": 820,
    "minPrice": 1536,
    "maxPrice": 1661,
    "bullRunner": "Yes"
  },
  {
    "Id": 21,
    "apartmentName": "Oak Ramble",
    "bed": 2,
    "bath": 2,
    "sqFt": 976,
    "minPrice": 1611,
    "maxPrice": 2662,
    "bullRunner": "Yes"
  },  {
    "Id": 22,
    "apartmentName": "Oak Ramble",
    "bed": 2,
    "bath": 2,
    "sqFt": 1054,
    "minPrice": 1752,
    "maxPrice": 2873,
    "bullRunner": "Yes"
  },
  {
    "Id": 23,
    "apartmentName": "Eagles Point",
    "bed": 1,
    "bath": 1,
    "sqFt": 650,
    "minPrice": 1489,
    "maxPrice": 1671,
    "bullRunner": "Yes"
  },
  {
    "Id": 24,
    "apartmentName": "Eagles Point",
    "bed": 1,
    "bath": 1,
    "sqFt": 750,
    "minPrice": 1386,
    "maxPrice": 1620,
    "bullRunner": "Yes"
  },
  {
    "Id": 25,
    "apartmentName": "Eagles Point",
    "bed": 2,
    "bath": 1,
    "sqFt": 850,
    "minPrice": 1900,
    "maxPrice": 2215,
    "bullRunner": "Yes"
  },
  {
    "Id": 26,
    "apartmentName": "Eagles Point",
    "bed": 3,
    "bath": 2,
    "sqFt": 1150,
    "minPrice": 2408,
    "maxPrice": 2867,
    "bullRunner": "Yes"
  },
  {
    "Id": 27,
    "apartmentName": "College Town",
    "bed": 1,
    "bath": 1,
    "sqFt": 838,
    "minPrice": 1500,
    "maxPrice": 1775,
    "bullRunner": "Yes"
  },
  {
    "Id": 28,
    "apartmentName": "College Town",
    "bed": 2,
    "bath": 2,
    "sqFt": 838,
    "minPrice": 950,
    "maxPrice": 1175,
    "bullRunner": "Yes"
  },
  {
    "Id": 29,
    "apartmentName": "College Town",
    "bed": 2,
    "bath": 2.5,
    "sqFt": 1210,
    "minPrice": 2100,
    "maxPrice": 2590,
    "bullRunner": "Yes"
  },
  {
    "Id": 30,
    "apartmentName": "College Town",
    "bed": 3,
    "bath": 3,
    "sqFt": 1244,
    "minPrice": 2700,
    "maxPrice": 3345,
    "bullRunner": "Yes"
  },
  {
    "Id": 31,
    "apartmentName": "College Town",
    "bed": 3,
    "bath": 3,
    "sqFt": 1054,
    "minPrice": 2550,
    "maxPrice": 3165,
    "bullRunner": "Yes"
  },
  {
    "Id": 32,
    "apartmentName": "42N Street",
    "bed": 2,
    "bath": 2,
    "sqFt": 943,
    "minPrice": 2341,
    "maxPrice": 2675,
    "bullRunner": "Yes"
  },
  {
    "Id": 33,
    "apartmentName": "42N Street",
    "bed": 3,
    "bath": 3,
    "sqFt": 1160,
    "minPrice": 2805,
    "maxPrice": 2880,
    "bullRunner": "Yes"
  },
  {
    "Id": 34,
    "apartmentName": "42N Street",
    "bed": 4,
    "bath": 4,
    "sqFt": 1440,
    "minPrice": 3600,
    "maxPrice": 3840,
    "bullRunner": "Yes"
  },
  {
    "Id": 35,
    "apartmentName": "Forest Lake",
    "bed": 2,
    "bath": 2,
    "sqFt": 1075,
    "minPrice": 2018,
    "maxPrice": 2068,
    "bullRunner": "Yes"
  },
  {
    "Id": 36,
    "apartmentName": "Forest Lake",
    "bed": 3,
    "bath": 3,
    "sqFt": 1445,
    "minPrice": 2562,
    "maxPrice": 2667,
    "bullRunner": "Yes"
  },
  {
    "Id": 37,
    "apartmentName": "Forest Lake",
    "bed": 4,
    "bath": 4,
    "sqFt": 1695,
    "minPrice": 3116,
    "maxPrice": 3196,
    "bullRunner": "Yes"
  }
];

        // Function to populate dropdowns
        function populateDropdowns() {
            var apartments = {};
            var beds = {};

            // Collect unique apartment names and bed numbers
            data.forEach(function (item) {
                apartments[item.apartmentName] = true;
                beds[item.bed] = true; // Use bed number as integer key
            });

            // Populate apartment dropdown
            var apartmentSelect = document.getElementById('apartmentSelect');
            for (var apartment in apartments) {
                var option = document.createElement('option');
                option.text = apartment;
                option.value = apartment;
                apartmentSelect.add(option);
            }

            // Populate bed dropdown
            var bedSelect = document.getElementById('bedSelect');
            for (var bed in beds) {
                var option = document.createElement('option');
                option.text = bed;
                option.value = bed;
                bedSelect.add(option);
            }
        }

        // Call function to populate dropdowns when the DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            populateDropdowns();
        });

        // Form submission handler
        document.getElementById('searchForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent default form submission

            // Fetch selected values from dropdowns
            var selectedApartment = document.getElementById('apartmentSelect').value;
            var selectedBed = parseInt(document.getElementById('bedSelect').value);

            // Filter data based on selected apartment and bed
            var filteredData = data.filter(function (item) {
                return item.apartmentName === selectedApartment && item.bed === selectedBed;
            });

            // Calculate average minPrice for the selected bed type and apartment
            var totalPrice = 0;
            var count = 0;
            filteredData.forEach(function (item) {
                totalPrice += item.minPrice;
                count++;
            });
            var averageMinPrice = count > 0 ? totalPrice / count : 0;

            // Calculate quartiles for all apartments for the selected bed type
            var prices = data.filter(function (item) {
                return item.bed === selectedBed;
            }).map(function (item) {
                return item.minPrice;
            }).sort(function (a, b) {
                return a - b;
            });
            var q1 = quartile(prices, 0.25);
            var q2 = quartile(prices, 0.5);
            var q3 = quartile(prices, 0.75);

            // Calculate needle value based on average minPrice
            var needleValue = averageMinPrice;

            // Update chart data and needle value
            var chart = window.myGauge;
            chart.data.datasets[0].data = [q1, q2, q3, Math.max.apply(null, prices)];
            chart.data.datasets[0].value = needleValue;
            chart.update();
        });

        // Quartile calculation function
        function quartile(arr, q) {
            var pos = (arr.length - 1) * q;
            var base = Math.floor(pos);
            var rest = pos - base;
            if (arr[base + 1] !== undefined) {
                return arr[base] + rest * (arr[base + 1] - arr[base]);
            } else {
                return arr[base];
            }
        }

        // Gauge chart configuration
        var config = {
            type: 'gauge',
            data: {
                datasets: [{
                    data: [0, 0, 0, 0],
                    value: 0,
                    backgroundColor: ['green', 'yellow', 'orange', 'red'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: 'Gauge chart'
                },
                layout: {
                    padding: {
                        bottom: 30
                    }
                },
                needle: {
                    radiusPercentage: 2,
                    widthPercentage: 3.2,
                    lengthPercentage: 80,
                    color: 'rgba(0, 0, 0, 1)'
                },
                valueLabel: {
                    formatter: Math.round
                }
            }
        };

        // Create chart
        var ctx = document.getElementById('chart').getContext('2d');
        window.myGauge = new Chart(ctx, config);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
